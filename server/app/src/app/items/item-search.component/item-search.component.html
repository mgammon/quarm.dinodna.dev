<div id="item-search-page">
  <p-panel header="Search Items" styleClass="container">
    <!-- Search -->
    <div style="padding: 1.5em 0.5em 0 0.5em">
      <span class="p-float-label p-input-icon-right">
        <i class="pi pi-search"></i>
        <input
          pInputText
          id="itemName"
          [(ngModel)]="options.search"
          (keydown.enter)="search()"
          pAutoFocus
          [autofocus]="true"
        />
        <label for="itemName">Item Name</label>
      </span>
      <p-button
        label="Search"
        icon="pi pi-search"
        iconPos="right"
        size="small"
        (click)="search()"
      ></p-button>
      <p-button
        label="Reset"
        size="small"
        [text]="true"
        (click)="reset()"
      ></p-button>
    </div>
    <p-divider align="left" (click)="showItemTypes = !showItemTypes">
      <i class="pi {{showItemTypes ? 'pi-angle-down' : 'pi-angle-right'}}"></i>
      <b> Item Info</b>
    </p-divider>
    <!-- Item Info -->
    <div *ngIf="showItemTypes" style="padding: 0 0.5em" class="item-info">
      <span class="p-float-label">
        <p-multiSelect
          inputId="classes"
          [options]="classOptions"
          [(ngModel)]="options.classes"
          optionLabel="label"
          optionValue="value"
          [showHeader]="false"
          [showClear]="true"
          placeholder="Any Class"
        ></p-multiSelect>
        <label for="classes">Classes</label>
      </span>
      <span class="p-float-label">
        <p-multiSelect
          inputId="races"
          [options]="raceOptions"
          [(ngModel)]="options.races"
          optionLabel="label"
          optionValue="value"
          [showHeader]="false"
          [showClear]="true"
          placeholder="Any Race"
        ></p-multiSelect>
        <label for="races">Races</label>
      </span>
      <span class="p-float-label">
        <p-multiSelect
          inputId="slots"
          [options]="slotOptions"
          [(ngModel)]="options.slots"
          optionLabel="label"
          optionValue="value"
          [showHeader]="false"
          [showClear]="true"
          placeholder="Any Slot"
        ></p-multiSelect>
        <label for="slots">Slots</label>
      </span>
      <span class="p-float-label">
        <p-multiSelect
          inputId="itemType"
          [options]="itemTypeOptions"
          [(ngModel)]="options.itemType"
          optionLabel="label"
          optionValue="value"
          [showHeader]="false"
          [showClear]="true"
          placeholder="Any Item Type"
        ></p-multiSelect>
        <label for="itemType">Item Types</label>
      </span>
      <span class="p-float-label">
        <p-dropdown
          inputId="effect"
          [options]="effectOptions"
          [(ngModel)]="options.effect"
          optionLabel="label"
          optionValue="value"
          [showClear]="true"
          placeholder="Effect"
        ></p-dropdown>
        <label for="effect">Effect</label>
      </span>

      <span class="tricheckbox">
        <label for="magic">Magic </label>
        <p-triStateCheckbox
          [(ngModel)]="options.magic"
          inputId="magic"
        ></p-triStateCheckbox>
      </span>
      <span class="tricheckbox">
        <label for="lore">Lore </label>
        <p-triStateCheckbox
          [(ngModel)]="options.lore"
          inputId="lore"
        ></p-triStateCheckbox>
      </span>
      <span class="tricheckbox">
        <label for="noDrop">No drop </label>
        <p-triStateCheckbox
          [(ngModel)]="options.noDrop"
          inputId="noDrop"
        ></p-triStateCheckbox>
      </span>
      <span class="tricheckbox">
        <label for="noRent">No rent </label>
        <p-triStateCheckbox
          [(ngModel)]="options.noRent"
          inputId="noRent"
        ></p-triStateCheckbox>
      </span>
      <app-comparable-number-input
        [decimals]="1"
        [comparableNumber]="options.stats.average7d"
        label="Week Avg"
        placeholder="platinum"
        [max]="1000000"
      />
      <app-comparable-number-input
        [decimals]="1"
        [comparableNumber]="options.stats.average30d"
        label="Month Avg"
        placeholder="platinum"
        [max]="1000000"
      />
    </div>
    <!-- Stats -->
    <p-divider align="left" (click)="showStats = !showStats">
      <i class="pi {{showStats ? 'pi-angle-down' : 'pi-angle-right'}}"></i>
      <b> Stats</b>
    </p-divider>
    <div *ngIf="showStats" (keydown.enter)="search()">
      <app-comparable-number-input
        [comparableNumber]="options.stats.dmg"
        label="DMG"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.delay"
        label="Delay"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.ac"
        label="AC"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.sta"
        label="STA"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.str"
        label="STR"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.dex"
        label="DEX"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.agi"
        label="AGI"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.cha"
        label="CHA"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.int"
        label="INT"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.wis"
        label="WIS"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.hp"
        label="HP"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.mana"
        label="Mana"
      />
      <app-comparable-number-input
        [decimals]="1"
        [comparableNumber]="options.stats.weight"
        label="Weight"
      />
    </div>
    <!-- Resists -->
    <p-divider align="left" (click)="showResists = !showResists">
      <i class="pi {{showResists ? 'pi-angle-down' : 'pi-angle-right'}}"></i>
      <b> Resists</b>
    </p-divider>
    <div *ngIf="showResists" (keydown.enter)="search()">
      <app-comparable-number-input
        [comparableNumber]="options.stats.mr"
        label="MR"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.fr"
        label="FR"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.cr"
        label="CR"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.pr"
        label="PR"
      />
      <app-comparable-number-input
        [comparableNumber]="options.stats.dr"
        label="DR"
      />
    </div>
    <!-- Item Table -->
    <p-divider class="no-bottom-margin"></p-divider>
    <p-table [value]="items" sortField="name" (onSort)="onSort($event)">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">
            Item <p-sortIcon field="name"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.dmg.value" pSortableColumn="damage">
            Damage <p-sortIcon field="damage"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.delay.value" pSortableColumn="delay">
            Delay <p-sortIcon field="delay"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.ac.value" pSortableColumn="ac">
            AC <p-sortIcon field="ac"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.sta.value" pSortableColumn="asta">
            STA <p-sortIcon field="asta"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.str.value" pSortableColumn="astr">
            STR <p-sortIcon field="astr"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.dex.value" pSortableColumn="adex">
            DEX <p-sortIcon field="adex"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.agi.value" pSortableColumn="aagi">
            AGI <p-sortIcon field="aagi"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.cha.value" pSortableColumn="acha">
            CHA <p-sortIcon field="acha"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.int.value" pSortableColumn="aint">
            INT <p-sortIcon field="aint"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.wis.value" pSortableColumn="awis">
            WIS <p-sortIcon field="awis"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.hp.value" pSortableColumn="hp">
            HP <p-sortIcon field="hp"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.mana.value" pSortableColumn="mana">
            Mana <p-sortIcon field="mana"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.weight.value" pSortableColumn="weight">
            Weight <p-sortIcon field="weight"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.mr.value" pSortableColumn="mr">
            MR <p-sortIcon field="mr"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.fr.value" pSortableColumn="fr">
            FR <p-sortIcon field="fr"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.cr.value" pSortableColumn="cr">
            CR <p-sortIcon field="cr"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.pr.value" pSortableColumn="pr">
            PR <p-sortIcon field="pr"></p-sortIcon>
          </th>
          <th *ngIf="!!options.stats.dr.value" pSortableColumn="dr">
            DR <p-sortIcon field="dr"></p-sortIcon>
          </th>
          <th
            *ngIf="!!options.stats.average7d.value"
            pSortableColumn="average7d"
          >
            Auction 7 Day Avg <p-sortIcon field="average7d"></p-sortIcon>
          </th>
          <th
            *ngIf="!!options.stats.average30d.value"
            pSortableColumn="average30d"
          >
            Auction 30 Day Avg <p-sortIcon field="average30d"></p-sortIcon>
          </th>
          <th>Slot</th>
          <!-- <th pSortableColumn="source">
            Source <p-sortIcon field="source"></p-sortIcon>
          </th> -->
          <!-- <th pSortableColumn="Type">
            Type <p-sortIcon field="type"></p-sortIcon>
          </th> -->
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>
            <app-item-link
              [itemId]="item.id"
              [itemName]="item.name"
              [itemIcon]="item.icon"
            />
          </td>
          <td *ngIf="!!options.stats.dmg.value">{{item.damage}}</td>
          <td *ngIf="!!options.stats.delay.value">{{item.delay}}</td>
          <td *ngIf="!!options.stats.ac.value">{{item.ac}}</td>
          <td *ngIf="!!options.stats.sta.value">{{item.asta}}</td>
          <td *ngIf="!!options.stats.str.value">{{item.astr}}</td>
          <td *ngIf="!!options.stats.dex.value">{{item.adex}}</td>
          <td *ngIf="!!options.stats.agi.value">{{item.aagi}}</td>
          <td *ngIf="!!options.stats.cha.value">{{item.acha}}</td>
          <td *ngIf="!!options.stats.int.value">{{item.aint}}</td>
          <td *ngIf="!!options.stats.wis.value">{{item.awis}}</td>
          <td *ngIf="!!options.stats.hp.value">{{item.hp}}</td>
          <td *ngIf="!!options.stats.mana.value">{{item.mana}}</td>
          <td *ngIf="!!options.stats.weight.value">{{item.weight / 10}}</td>
          <td *ngIf="!!options.stats.average7d.value"><app-price [price]="item.average7d" [noZeroes]="true" /></td>
          <td *ngIf="!!options.stats.average30d.value"><app-price [price]="item.average30d" [noZeroes]="true" /></td>
          <td *ngIf="!!options.stats.mr.value">{{item.mr}}</td>
          <td *ngIf="!!options.stats.fr.value">{{item.fr}}</td>
          <td *ngIf="!!options.stats.cr.value">{{item.cr}}</td>
          <td *ngIf="!!options.stats.pr.value">{{item.pr}}</td>
          <td *ngIf="!!options.stats.dr.value">{{item.dr}}</td>
          <td>{{getSlotsString(item)}}</td>
          <!-- <td>{{item.maxCount}}</td> -->
          <!-- <td>{{getItemType(item)}}</td> -->
        </tr>
      </ng-template>
    </p-table>
    <div class="no-results" *ngIf="items.length === 0">No results</div>
    <!-- <p-button
      label="Load more"
      size="small"
      (click)="nextPage()"
      *ngIf="hasMoreToLoad && !loading"
    ></p-button> -->
    <p-divider align="center" *ngIf="!hasMoreToLoad && items.length">
      <!-- <i class="pi pi-angle-up"></i> -->
      <b> End of results </b>
      <!-- <i class="pi pi-angle-up"></i> -->
    </p-divider>
  </p-panel>
</div>
